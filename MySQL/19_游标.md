# 游标
> 在数据库中，游标是个重要的概念，它提供了一种灵活的操作方式，可以从数据结果集中每次提取一条数据记录进行操作。游标让 SQL 这种面向集合的语言有了面向过程开发的能力。可以说，游标是面向过程的编程方式，这与面向集合的编程方式有所不同。在 SQL 中，游标是一种临时的数据库对象，可以指向存储在数据库表中的数据行指针。这里游标充当了指针的作用，可以通过操作游标来对数据行进行操作。


## 1. 定义游标
```
DECLARE cursor_name CURSOR FOR select_statement
```
这个语法适用于 MySQL，SQL Server，DB2 和 MariaDB。如果是用 Oracle 或者 PostgreSQL，需要写成：
```
DECLARE cursor_name CURSOR IS select_statement
```
要使用 SELECT 语句来获取数据结果集，而此时还没有开始遍历数据，这里 select_statement 代表的是 SELECT 语句


## 2. 打开游标
```
OPEN cursor_name
```
定义好游标之后，如果想要使用游标，必须先打开游标。打开游标的时候 SELECT 语句的查询结果集就会送到游标工作区。


## 3. 从游标中取得数据
```
FETCH cursor_name INTO var_name ...
```
这句的作用是使用 cursor_name 这个游标来读取当前行，并且将数据保存到 var_name 这个变量中，游标指针指到下一行。如果游标读取的数据行有多个列名，则在 INTO 关键字后面赋值给多个变量名即可。


## 4. 关闭游标
```
CLOSE cursor_name
```
使用完游标后需要关闭掉该游标。关闭游标之后，就不能再检索查询结果中的数据行，如果需要检索只能再次打开游标。


## 5. 释放游标
```
DEALLOCATE cursor_name
```
一定要养成释放游标的习惯，否则游标会一直存在于内存中，直到进程结束后才会自动释放。当不需要使用游标的时候，释放游标可以减少资源浪费。


## 6. 游标的优缺点

优点:
```
灵活性强, 可以解决复杂的数据处理问题, 对数据行逐行扫描处理
```

缺点:
```
使用游标的过程中会对数据行加锁, 当业务并发量大的时候, 会影响到业务的效率, 同时游标是在内存中进行的处理, 会消耗系统资源, 容易造成内存不足.
```
