# DDL&DML
> DDL&DML 是 DBMS 的核心组件，也是 SQL 的重要组成部分，DDL&DML 的正确性和稳定性是整个 SQL 运行的重要基础
---


## 1、针对数据库

1. 查看已有的库：
```
SHOW DATABASES;
```

2. 创建库：([]内是指定字符集，选填)
```
CREATE DATABASE 库名 [DEFAULT CHARSET = utf8]; 
或：
CREATE DATABASE IF NOT EXISTS 库名 [DEFAULT CHARSET utf8 COLLATE utf8_general_ci];
```

3. 查看创建库的语句：
```
SHOW CREATE DATABASE 库名;
```

4. 切换库：
```
USE 库名;
```

5. 查看当前所在库：
```
SELECT DATABASE();
```

6. 查看当前库中已有的表：
```
SHOW TABLES;
```

7. 删除库：
```
DROP DATABASE 库名;
```

注意：
```
COLLATE utf8_general_ci 代表的是数据库校对规则，utf8_bin将字符串中的每一个字符用二进制数据存储，区分大小写。utf8_genera_ci不区分大小写，ci为case insensitive的缩写，即大小写不敏感。utf8_general_cs区分大小写，cs为case sensitive的缩写，即大小写敏感。
```
---


## 2、针对数据表

1. 创建表：([]内选填)
```
DROP TABLE IF EXISTS 表名;
CREATE TABLE 表名(
    id INT(11) NOT NULL AUTO_INCREMENT,
    字段名 数据类型 [完整性约束条件],
    字段名 数据类型 [完整性约束条件],
    .....,
    PRIMARY KEY (`id`) USING BTREE
)[ENGINE = InnoDB AUTO_INCREMENT = 10069 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic];
```

2. 查看创建表的语句（字符集）
```
SHOW CREATE TABLE 表名;
```

3. 查看表结构
```
DESC 表名;
```

4. 修改表名：
```
ALTER TABLE table_name RENAME table_new_name;
```

5. 删除表：
```
DROP TABLE 表名;
```

注意：所有的数据都是以文件的形式存储在数据库目录下的数据库目录：/var/lib/mysql

---


## 3、针对表字段
> 语法：ALTER TABLE 表名 执行动作;

1. 添加字段(add)
```
1、添加字段到末尾：ALTER TABLE 表名 ADD 字段名 数据类型 [完整性约束条件];

2、添加字段到开始：ALTER TABLE 表名 ADD 字段名 数据类型 [完整性约束条件] FIRST;

3、添加字段到指定位置：ALTER TABLE 表名 ADD 字段名 数据类型 [完整性约束条件] AFTER 字段名;
```

2. 删除字段(drop)
```
ALTER TABLE 表名 DROP 字段名;
```

3. 修改数据类型(modify)
```
ALTER TABLE 表名 MODIFY 字段名 新的数据类型 [完整性约束条件];
```

4. 修改字段名(change)
```
ALTER TABLE 表名 CHANGE 旧名 新名 数据类型 [完整性约束条件];
```
---


## 4、表记录的管理：

1. 在表中插入记录([]内选填)
```
INSERT INTO 表名[字段名] VALUES(值1, 值2),.......;
```

2. 更新表记录
```
UPDATE 表名 SET 字段名 = 值, 字段名 = 值, ... WHERE 条件;

WHERE 条件子句（配合查、改、删操作）
```

3. 删除表记录
```
DELETE FROM 表名 WHERE 条件；
```

注意：更新或删除如果不加where子句，将会把表中所有记录全部更改或删除

---


## 5、库\表\字段的命名规则：
```
1、可以使用数字、字母、_，但是不能是纯数字
2、库名区分字母大小写
3、库名具有唯一性
4、不能使用特殊字符和mysql关键字
```
---


## 6, 设计数据表的原则

1. 在设计数据表的时候，经常会考虑到各种问题
```
用户都需要什么数据？
需要在数据表中保存哪些数据？
哪些数据是经常访问的数据？
如何提升检索效率？
如何保证数据表中数据的正确性，当插入、删除、更新的时候该进行怎样的约束检查？
如何降低数据表的数据冗余度，保证数据表不会因为用户量的增长而迅速扩张？
如何让负责数据库维护的人员更方便地使用数据库？
```

2. “三少一多”原则：
```
1. 数据表的个数越少越好, RDBMS 的核心在于对实体和联系的定义，也就是 E-R 图（Entity Relationship Diagram），数据表越少，证明实体和联系设计得越简洁，既方便理解又方便操作。

2. 数据表中的字段个数越少越好, 字段个数越多，数据冗余的可能性越大。设置字段个数少的前提是各个字段相互独立，而不是某个字段的取值可以由其他字段计算出来。当然字段个数少是相对的，通常会在数据冗余和检索效率中进行平衡。

3. 数据表中联合主键的字段个数越少越好, 设置主键是为了确定唯一性，当一个字段无法确定唯一性的时候，就需要采用联合主键的方式（也就是用多个字段来定义一个主键）。联合主键中的字段越多，占用的索引空间越大，不仅会加大理解难度，还会增加运行时间和索引空间，因此联合主键的字段个数越少越好。

4. 使用主键和外键越多越好, 数据库的设计实际上就是定义各种表，以及各种字段之间的关系。这些关系越多，证明这些实体之间的冗余度越低，利用度越高。这样做的好处在于不仅保证了数据表之间的独立性，还能提升相互之间的关联使用率。
```

> “三少一多”原则的核心就是简单可复用。简单指的是用更少的表、更少的字段、更少的联合主键字段来完成数据表的设计。可复用则是通过主键、外键的使用来增强数据表之间的复用率。因为一个主键可以理解是一张表的代表。键设计得越多，证明它们之间的利用率越高。

注意:
```
是否使用外键确实会有一些争议。
首先，外键本身是为了实现强一致性，所以如果需要正确性>性能的话，还是建议使用外键，它可以在数据库的层面保证数据的完整性和一致性。
当然不用外键，也可以在业务层进行实现。不过，这样做也同样存在一定的风险，因为这样，就会让业务逻辑会与数据具备一定的耦合性。也就是业务逻辑和数据必须同时修改。而且在工作中，业务层可能会经常发生变化。

当然，很多互联网的公司，尤其是超大型的数据应用场景，大量的插入，更新和删除在外键的约束下会降低性能，同时数据库在水平拆分和分库的情况下，数据库端也做不到执行外键约束。另外，在高并发的情况下，外键的存在也会造成额外的开销。
因为每次更新数据，都需要检查另外一张表的数据，也容易造成死锁。

所以在这种情况下，尤其是大型项目中后期，可以采用业务层来实现，取消外键提高效率。
不过在SQL学习之初，包括在系统最初设计的时候，还是建议采用规范的数据库设计，也就是采用外键来对数据表进行约束。因为这样可以建立一个强一致性，可靠性高的数据库结构，也不需要在业务层来实现过多的检查。
当然在项目后期，业务量增大的情况下，需要更多考虑到数据库性能问题，可以分析有哪些外键造成了过多的性能消耗。一般遵循2/8原则，会有20%的外键造成80%的资源效率，可以只把这20%的外键进行开放，采用业务层逻辑来进行实现, 
从而取消外键的约束，转移到业务层来实现, 当然需要保证业务层的实现没有错误。不同阶段，考虑的问题不同。而且在大型互联网项目中，考虑到分库分表的情况，也会降低外键的使用, 或通过减少外键的使用，来减低死锁发生的概率，提高并发处理能。
```
