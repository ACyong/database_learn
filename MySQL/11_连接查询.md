# 连接查询
> 在数据库中，表的组成是基于关系模型的，所以一个表就是一个关系。一个数据库中可以包括多个表，也就是存在多种数据之间的关系。而之所以能使用 SQL 语言对各个数据表进行复杂查询，核心就在于连接，它可以用一条 SELECT 语句在多张表之间进行查询。关系型数据库的核心之一就是连接。
---

## 1. 交叉连接
> 交叉连接实际上就是 SQL92 中的笛卡尔乘积，采用的是 CROSS JOIN。基本不会使用

语法格式
```
-- SQL92
SELECT 字段名 FROM 表1, 表2;
```
```
-- SQL99
SELECT 字段名 FROM 表1 CROSS JOIN 表2;
```


## 2. 自然连接
> 自然连接理解为 SQL92 中的等值连接, 是一种特殊的等值连接，要求两个关系表中有相同的属性列（名字相同）,所有属性列的值相同才会显示出来，无须添加连接条件，并且在结果中消除重复的属性列。若两个没有公共属性的关系表进行自然连接,则其自然连接转化为笛卡尔积。

语法格式:
```
-- SQL92 也叫隐式内连接, 不推荐
SELECT 字段名 FROM 左表, 右表 WHERE 等值条件;
```
```
-- SQL99
SELECT 字段名 FROM 左表 NATURAL JOIN 右表;
```


## 3. ON 连接
> 通过指定的条件去匹配两张表中的数据, 匹配上就显示,匹配不上就不显示. ON 用来指定连接条件，可以实现自然连接的功能, 也可以进行非等值连接, 一般来说在 SQL99 中，需要连接的表会采用 JOIN 进行连接，ON 指定了连接条件，后面可以是等值连接，也可以采用非等值连接。

语法格式:
```
-- 也叫显式内连接, 推荐
SELECT 字段名 FROM 左表 [INNER] JOIN 右表 ON 条件
```


## 4. 外连接
> 在 SQL92 中有左外连接、右外连接，在 SQL99 中还有全外连接。全外连接实际上就是左外连接和右外连接的结合。在这三种外连接中，一般省略 OUTER 不写。需要注意的是 MySQL 不支持全外连接，否则的话全外连接会返回左表和右表中的所有行。当表之间有匹配的行，会显示内连接的结果。当某行在另一个表中没有匹配时，那么会把另一个表中选择的列显示为空值。也就是说，全外连接的结果 = 左右表匹配的数据 + 左表没有匹配到的数据 + 右表没有匹配到的数据。

语法格式
```
-- 以左表为基准, 匹配右边表中的数据,如果匹配的上,就展示匹配到的数据,如果匹配不到, 左表中的数据正常展示, 右边的展示为null.
SELECT 字段名 FROM 左表 LEFT [OUTER] JOIN 右表 ON 条件

-- 以右表为基准，匹配左边表中的数据，如果能匹配到，展示匹配到的数据,如果匹配不到，右表中的数据正常展示, 左边展示为null
SELECT 字段名 FROM 左表 RIGHT [OUTER ]JOIN 右表 ON 条件
```


## 5. USING 连接
> using和on的区别在于需要连接的两个表的属性名相同的时候使用using和on效果一样，而属性名不同的时候必须使用on

```
内自然连接：
select * from tbl_ name1 natural join tbl_name2;
内自然连接相当于using为判断语句的内连接：即：
select * from tbl_name1 inner join tbl_name2 using (共有字段);

左外自然连接：
select * from tbl_name1 natural left join tbl_name2;
左外自然连接相当于using为判断语句的左外连接：
select * from tbl_name1 left outer join tbl_name2 using(共有字段);

右外自然连接：
select * from tbl_name1 natural right join tbl_name2;
右外自然连接相当于using为判断语句的右外连接：
select * from tbl_name1 right outer join tbl_name2 using (共有字段);
```


## 6. 自连接
> 自连接的原理在 SQL92 和 SQL99 中都是一样的，只是表述方式不同。连接的两个表都是同一个表的内连接


## 7. 连接方式的总结
> 内连接和左外连接使用居多

1. 内连接: 只获取两张表中交集部分的数据.
2. 左外连接: 以左表为基准,查询左表的所有数据, 以及与右表有交集的部分
3. 右外连接: 以右表为基准,查询右表的所有的数据,以及与左表有交集的部分

注意: 
```
1. 不是所有的 DBMS 都支持全外连接虽然 SQL99 标准提供了全外连接，但不是所有的 DBMS 都支持。不仅 MySQL 不支持，Access、SQLite、MariaDB 等数据库软件也不支持。不过在 Oracle、DB2、SQL Server 中是支持的。

2. Oracle 没有表别名 AS为了让 SQL 查询语句更简洁，经常会使用表别名 AS，不过在 Oracle 中是不存在 AS 的，使用表别名的时候，直接在表名后面写上表别名即可，比如 player p，而不是 player AS p。

3. SQLite 的外连接只有左连接SQLite 是一款轻量级的数据库软件，在外连接上只支持左连接，不支持右连接，不过如果想使用右连接的方式，比如table1 RIGHT JOIN table2，在 SQLite 可以写成table2 LEFT JOIN table1，这样就可以得到相同的效果。
```


## 8. 关于连接的性能问题需要注意

1. 控制连接表的数量: 多表连接就相当于嵌套 for 循环一样，非常消耗资源，会让 SQL 查询性能下降得很严重，因此不要连接不必要的表。在许多 DBMS 中，也都会有最大连接表的限制。

2. 在连接时不要忘记 WHERE 语句: 多表连接的目的不是为了做笛卡尔积，而是筛选符合条件的数据行，因此在多表连接的时候不要忘记了 WHERE 语句，这样可以过滤掉不必要的数据行返回。

3. 使用自连接而不是子查询: 可以使用子查询也可以使用自连接时一般建议使用自连接，因为在许多 DBMS 的处理过程中，对于自连接的处理速度要比子查询快得多。子查询实际上是通过未知表进行查询后的条件判断，而自连接是通过已知的自身数据表进行条件判断，因此在大部分 DBMS 中都对自连接处理进行了优化。


## 9. UNION 合并查询
> UNION 操作符用于合并两个或多个 SELECT 语句的结果集，并消除重复行。UNION ALL 运算符用于将两个 SELECT 语句的结果组合在一起，重复行也包含在内. UNION ALL 运算符所遵从的规则与 UNION 一致。

语法格式:
```
SELECT column1 [, column2 ] FROM table1 [, table2 ] [WHERE condition] 
UNION 
SELECT column1 [, column2 ] FROM table1 [, table2 ] [WHERE condition]
```

注意:
```
UNION 内部的 SELECT 语句必须拥有相同数量的列, 列的名称不必相同。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的列的顺序必须相同。在重复检查期间，NULL值不会被忽略. 在执行效率上，UNION ALL 要比UNION快很多，因此，若可以确认合并的两个结果集中不包含重复数据，那么就使用UNION ALL。
```
