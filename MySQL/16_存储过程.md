# 存储过程
> SQL 的存储过程，和视图一样，都是对 SQL 代码进行封装，可以反复利用。它和视图有着同样的优点，清晰、安全，还可以减少网络传输量。不过它和视图不同，视图是虚拟表，通常不对底层数据表直接操作，而存储过程是程序化的 SQL，可以直接操作底层数据表，相比于面向集合的操作方式，能够实现一些更复杂的数据处理。存储过程可以说是由 SQL 语句和流控制语句构成的语句集合，它和函数一样，可以接收输入参数，也可以返回输出参数给调用者，返回计算结果。


## 1. 创建存储过程
```
CREATE PROCEDURE `存储过程名称`([参数列表])
BEGIN
    需要执行的语句
END
```

注意: 

DELIMITER 的作用
```
如果使用 Navicat 这个工具来管理 MySQL 执行存储过程，那么直接执行上面这段代码就可以了。因为在编写存储过程的时候，Navicat 会自动设置 DELIMITER 为其他符号，不需要再进行 DELIMITER 的操作
如果用的是 MySQL，还需要用 DELIMITER 来临时定义新的结束符。因为默认情况下 SQL 采用（；）作为结束符，这样当存储过程中的每一句 SQL 结束之后，采用（；）作为结束符，就相当于告诉 SQL 可以执行这一句了。
但是存储过程是一个整体，并不希望 SQL 逐条执行，而是采用存储过程整段执行的方式，因此我们就需要临时定义新的 DELIMITER，新的结束符可以用（//）或者（$$）, 应该写成这样:

DELIMITER //
CREATE PROCEDURE `存储过程名称`([参数列表])
BEGIN
    需要执行的语句
END
DELIMITER ;

首先用（//）作为结束符，又在整个存储过程结束后采用了（//）作为结束符号，告诉 SQL 可以执行了，然后再将结束符还原成默认的（;）
```

## 2. 存储过程的 3 种参数类型

| 参数类型 | 是否返回 | 作用 |
| ------ | ------- | ---- |
| IN     | 否       | 向存储过程传入参数,存储过程中修改该参数的值,不能被返回 |
| OUT    | 是       | 把存储过程计算的结果放到该参数中,调用者可以得到返回值  |
| INOUT  | 是       | IN 和 OUT的结合,既用于存储过程的传入参数,同时又可以把计算结果放到参数中,调用者可以得到返回值 |


## MySQL存储过程的优缺点
优点:
```
通常存储过程有助于提高应用程序的性能。一旦创建，存储过程就会被编译并存储在数据库中。但是，MySQL实现的存储过程略有不同。MySQL存储过程是按需编译的。编译存储过程后，MySQL将其放入缓存并为每个连接维护自己的存储过程缓存。如果应用程序在单个连接中多次使用存储过程，则使用编译版本，否则，存储过程的工作方式类似于查询。

存储过程有助于减少应用程序和数据库服务器之间的流量，因为应用程序必须只发送存储过程的名称和参数，而不是发送多个冗长的SQL语句。

存储过程对任何应用程序都是可重用且透明的。存储过程将数据库接口公开给所有应用程序，以便开发人员不必开发存储过程中已经支持的功能。

存储过程是安全的。数据库管理员可以为访问数据库中的存储过程的应用程序授予适当的权限，而无需为基础数据库表提供任何权限。

除了这些优点之外，存储过程也有其自身的缺点，在数据库中使用它们之前应注意这些缺点。
```

缺点:
```
如果使用许多存储过程，则使用这些存储过程的每个连接的内存使用量将显着增加。此外，如果在存储过程中过度使用大量逻辑操作，CPU使用率将会增加，因为数据库服务器没有针对逻辑操作进行良好设计。

存储过程的构造不是为开发复杂和灵活的业务逻辑而设计的。

调试存储过程很困难。只有少数数据库管理系统允许您调试存储过程。不幸的是，MySQL没有提供调试存储过程的工具。

开发和维护存储过程并不容易。开发和维护存储过程通常需要一种并非所有应用程序开发人员都具备的专业技能。这可能会导致应用程序开发和维护阶段出现问题。
```
